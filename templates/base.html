<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Social Network{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/force-fix.css"> <!-- –£–õ–¨–¢–†–ê-–§–ò–ö–° -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- –ò–ù–õ–ê–ô–ù –°–¢–ò–õ–ò –î–õ–Ø –ì–ê–†–ê–ù–¢–ò–ò -->
    <style>
    /* –ê–í–ê–†–¢–ê–†–ö–ò –ù–ï –ú–û–ì–£–¢ –ë–´–¢–¨ –ë–û–õ–¨–®–ò–ú–ò! */
    .user-avatar-small, .user-avatar, [class*="avatar"] {
        width: 32px !important;
        height: 32px !important;
        max-width: 32px !important;
        max-height: 32px !important;
        min-width: 32px !important;
        min-height: 32px !important;
    }
    .user-avatar {
        width: 40px !important;
        height: 40px !important;
        max-width: 40px !important;
        max-height: 40px !important;
    }
    img[src*="profile_picture"] {
        width: 40px !important;
        height: 40px !important;
        max-width: 40px !important;
        max-height: 40px !important;
    }

    /* –ì–ê–†–ê–ù–¢–ò–Ø –ë–û–õ–¨–®–ò–• –§–û–¢–û–ì–†–ê–§–ò–ô */
    .photo-large, .photo-detail-image {
        max-width: 100% !important;
        max-height: 80vh !important;
        width: auto !important;
        height: auto !important;
        border-radius: 15px !important;
    }
    .photo-card-image {
        height: 400px !important;
        object-fit: cover !important;
        border-radius: 8px 8px 0 0 !important;
    }

    /* –§–ò–ö–°: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–≤–∞—Ç–∞—Ä–∫–∞–º–∏ */
    img:not([class*="avatar"]):not(.user-avatar):not(.user-avatar-small) {
        width: auto !important;
        height: auto !important;
        max-width: 100% !important;
        border-radius: 0 !important;
        object-fit: initial !important;
    }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <a href="{% url 'photo_list' %}" style="color: inherit; text-decoration: none;">
                        <i class="fas fa-home"></i> Social Network
                    </a>
                </div>
                <div class="nav-links">
                    {% if user.is_authenticated %}
                        <a href="{% url 'user_profile' user.username %}">
                            <i class="fas fa-user"></i> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                        </a>
                        <a href="{% url 'profile_edit' %}">
                            <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </a>
                        <a href="{% url 'logout' %}">
                            <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                        </a>
                    {% else %}
                        <a href="{% url 'login' %}">
                            <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                        </a>
                        <a href="{% url 'register' %}">
                            <i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                        </a>
                    {% endif %}
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Social Network. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/js/main.js"></script>

    <!-- –£–õ–¨–¢–†–ê-–°–ö–†–ò–ü–¢ –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–í–ê–¢–ê–†–û–ö –ò –õ–ê–ô–ö–û–í -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ ULTRA-FIX ACTIVATED');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ø–î–ï–†–ù–û–ì–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–∫
        function nuclearAvatarFix() {
            const avatars = document.querySelectorAll(`
                img,
                [class*="avatar"],
                img[src*="profile_picture"],
                img[src*="/media/"]
            `);

            avatars.forEach(avatar => {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                if (avatar.classList.contains('photo-card-image') || 
                    avatar.classList.contains('photo-detail-image') ||
                    avatar.classList.contains('photo-large') ||
                    avatar.src?.includes('/media/photos/')) {
                    return;
                }

                // –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –í–°–ï —Å—Ç–∏–ª–∏
                avatar.style.cssText = '';

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
                if (avatar.closest('.comment-item') || avatar.classList.contains('user-avatar-small')) {
                    avatar.style.cssText = `
                        width: 32px !important;
                        height: 32px !important;
                        max-width: 32px !important;
                        max-height: 32px !important;
                        min-width: 32px !important;
                        min-height: 32px !important;
                        border-radius: 50% !important;
                        object-fit: cover !important;
                        border: 1px solid #3498db !important;
                        display: block !important;
                    `;
                    avatar.className = 'user-avatar-small';
                } else {
                    avatar.style.cssText = `
                        width: 40px !important;
                        height: 40px !important;
                        max-width: 40px !important;
                        max-height: 40px !important;
                        min-width: 40px !important;
                        min-height: 40px !important;
                        border-radius: 50% !important;
                        object-fit: cover !important;
                        border: 2px solid #3498db !important;
                        display: block !important;
                    `;
                    avatar.className = 'user-avatar';
                }
            });

            console.log('Fixed', avatars.length, 'avatars');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
        function nuclearPhotoFix() {
            const photos = document.querySelectorAll(`
                .photo-card-image,
                .photo-detail-image,
                .photo-large,
                img[src*="/media/photos/"]
            `);

            photos.forEach(photo => {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏
                photo.style.cssText = '';

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
                if (photo.classList.contains('photo-card-image')) {
                    photo.style.cssText = `
                        width: 100% !important;
                        height: 400px !important;
                        object-fit: cover !important;
                        border-radius: 8px 8px 0 0 !important;
                        display: block !important;
                    `;
                } else if (photo.classList.contains('photo-detail-image') || photo.classList.contains('photo-large')) {
                    photo.style.cssText = `
                        max-width: 100% !important;
                        max-height: 80vh !important;
                        width: auto !important;
                        height: auto !important;
                        object-fit: contain !important;
                        border-radius: 15px !important;
                        display: block !important;
                        margin: 0 auto !important;
                    `;
                }
            });

            console.log('Fixed', photos.length, 'photos');
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
        nuclearAvatarFix();
        nuclearPhotoFix();

        setTimeout(() => {
            nuclearAvatarFix();
            nuclearPhotoFix();
        }, 100);
        
        setTimeout(() => {
            nuclearAvatarFix();
            nuclearPhotoFix();
        }, 500);
        
        setTimeout(() => {
            nuclearAvatarFix();
            nuclearPhotoFix();
        }, 1000);

        window.addEventListener('load', () => {
            nuclearAvatarFix();
            nuclearPhotoFix();
        });
    });
    </script>
</body>
</html>